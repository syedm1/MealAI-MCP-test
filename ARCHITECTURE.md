# 🏗️ MealAI Architecture

## 🔧 System Overview

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                                   USER LAYER                                   │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐            │
│  │   Claude Desktop │    │   Web Browser   │    │   Mobile App    │            │
│  │    (Primary)     │    │   (pgAdmin)     │    │   (Future)      │            │
│  └─────────────────┘    └─────────────────┘    └─────────────────┘            │
│           │                        │                        │                  │
└───────────┼────────────────────────┼────────────────────────┼──────────────────┘
            │                        │                        │
            │ MCP Protocol           │ HTTP                   │ REST API
            │ (JSON-RPC)             │ (Port 8080)            │ (Future)
            │                        │                        │
┌───────────┼────────────────────────┼────────────────────────┼──────────────────┐
│           │                        │                        │  INTERFACE LAYER │
├───────────▼────────────────────────▼────────────────────────▼──────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐                │
│  │                    MCP SERVER                               │                │
│  │               (Node.js + TypeScript)                       │                │
│  │                                                             │                │
│  │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌────────┐ │                │
│  │  │search_food  │ │food_nutrients│ │ log_meal   │ │analyze │ │                │
│  │  │    Tool     │ │    Tool      │ │   Tool     │ │  Tool  │ │                │
│  │  └─────────────┘ └─────────────┘ └─────────────┘ └────────┘ │                │
│  │         │               │               │           │       │                │
│  │         └───────────────┼───────────────┼───────────┘       │                │
│  │                         │               │                   │                │
│  │  ┌─────────────────────────────────────────────────────────┐ │                │
│  │  │              REQUEST HANDLER                            │ │                │
│  │  │         (Zod Validation + Error Handling)              │ │                │
│  │  └─────────────────────────────────────────────────────────┘ │                │
│  └─────────────────────────────────────────────────────────────┘                │
│           │                                           │                         │
└───────────┼───────────────────────────────────────────┼─────────────────────────┘
            │                                           │
            │ HTTP/REST                                 │ PostgreSQL
            │ (Port 443)                                │ Protocol
            │                                           │ (Port 5432)
            │                                           │
┌───────────▼───────────────────────────────────────────▼─────────────────────────┐
│                                DATA LAYER                                      │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────┐    ┌─────────────────────────────────────┐ │
│  │         NUTRITIONIX API         │    │        POSTGRESQL DATABASE         │ │
│  │      (External Service)         │    │         (Docker Container)         │ │
│  │                                 │    │                                     │ │
│  │ ┌─────────────────────────────┐ │    │ ┌─────────────────────────────────┐ │ │
│  │ │  /v2/search/instant         │ │    │ │           users                 │ │ │
│  │ │  (Food Search)              │ │    │ │    (id, email, created_at)      │ │ │
│  │ └─────────────────────────────┘ │    │ └─────────────────────────────────┘ │ │
│  │                                 │    │                                     │ │
│  │ ┌─────────────────────────────┐ │    │ ┌─────────────────────────────────┐ │ │
│  │ │  /v2/search/item            │ │    │ │         profiles                │ │ │
│  │ │  (Branded Foods)            │ │    │ │ (user_id, age, sex, goals,      │ │ │
│  │ └─────────────────────────────┘ │    │ │  activity_level, allergies)     │ │ │
│  │                                 │    │ └─────────────────────────────────┘ │ │
│  │ ┌─────────────────────────────┐ │    │                                     │ │
│  │ │  /v2/natural/nutrients      │ │    │ ┌─────────────────────────────────┐ │ │
│  │ │  (Natural Language)         │ │    │ │           meals                 │ │ │
│  │ └─────────────────────────────┘ │    │ │ (id, user_id, food_name,        │ │ │
│  └─────────────────────────────────┘    │ │  macros, eaten_at, qty)         │ │ │
│                                         │ └─────────────────────────────────┘ │ │
│                                         └─────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 🚀 Component Details

### 1. User Layer
- **Claude Desktop**: Primary interface using MCP protocol
- **pgAdmin**: Database administration via web browser
- **Future Mobile App**: REST API integration planned

### 2. Interface Layer - MCP Server
- **Technology**: Node.js + TypeScript
- **Protocol**: Model Context Protocol (JSON-RPC over stdio)
- **Tools**:
  - `search_food`: Nutritionix food search
  - `food_nutrients`: Nutrition analysis
  - `log_meal`: Meal logging to database
  - `analyze_day`: Daily nutrition analysis

### 3. Data Layer
- **Nutritionix API**: External nutrition data source
- **PostgreSQL**: Local data persistence

## 🔄 Data Flow Diagrams

### Food Search Flow
```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   Claude    │───▶│ MCP Server  │───▶│ Nutritionix │───▶│  Response   │
│ "search     │    │search_food  │    │    API      │    │ (JSON data) │
│  chicken"   │    │    tool     │    │             │    │             │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
```

### Meal Logging Flow
```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   Claude    │───▶│ MCP Server  │───▶│ PostgreSQL  │───▶│ Confirmation│
│ "log 6oz    │    │  log_meal   │    │ Database    │    │  Message    │
│  salmon"    │    │    tool     │    │             │    │             │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
```

### Nutrition Analysis Flow
```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   Claude    │───▶│ MCP Server  │───▶│ Nutritionix │───▶│ PostgreSQL  │───▶│ Daily       │
│ "2 eggs +   │    │food_nutrients│    │Natural Lang │    │ Database    │    │ Analysis    │
│  toast"     │    │    tool     │    │    API      │    │             │    │ + Goals     │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
```

## 🏭 Developemnt Environment
```
┌─────────────────────────────────────────────────────────────┐
│                    LOCAL MACHINE                            │
│                                                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │   Claude    │  │ MCP Server  │  │      Docker         │  │
│  │  Desktop    │  │(localhost)  │  │                     │  │
│  │             │  │             │  │ ┌─────────────────┐ │  │
│  │             │  │             │  │ │   PostgreSQL    │ │  │
│  │             │  │             │  │ │  (Port 5432)    │ │  │
│  │             │  │             │  │ └─────────────────┘ │  │
│  │             │  │             │  │ ┌─────────────────┐ │  │
│  │             │  │             │  │ │    pgAdmin      │ │  │
│  │             │  │             │  │ │  (Port 8080)    │ │  │
│  │             │  │             │  │ └─────────────────┘ │  │
│  └─────────────┘  └─────────────┘  └─────────────────────┘  │
│         │                │                     │            │
│         └────────────────┼─────────────────────┘            │
│                          │                                  │
│                          ▼                                  │
│               ┌─────────────────┐                           │
│               │  Nutritionix    │                           │
│               │     API         │                           │
│               │  (External)     │                           │
│               └─────────────────┘                           │
└─────────────────────────────────────────────────────────────┘
```
